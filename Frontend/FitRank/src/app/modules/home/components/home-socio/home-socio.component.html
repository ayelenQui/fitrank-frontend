<div *ngIf="!esProfesor" class="fondo container-fluid min-vh-100 bg-light py-4">

  <app-header-socio [user]="user"></app-header-socio>

  <!-- SALUDO -->
  <div class="text-center mb-4">
    <h2 class="display-6 fw-bold text-dark">¬°Hola, {{ user.nombre }}!</h2>
    <p class="text-muted fs-5">Tu progreso te est√° llevando al siguiente nivel </p>
    <div class="badge bg-fitrank-subtle text-fitrank fs-6">
      Nivel Actual: <strong>{{ socio?.nivel }}</strong>
    </div>
  </div>


  <!-- ===================================== -->
  <!-- üü£ DASHBOARD 3 COLUMNAS -->
  <!-- ===================================== -->
  <div class="row g-4">

    <!-- ========================= -->
    <!-- üü° COLUMNA IZQUIERDA -->
    <!-- ========================= -->
    <div class="col-lg-4 col-md-12">

      <!-- Ocupaci√≥n -->
      <div class="ocupacion-card bg-white shadow rounded-4 p-4 mb-4">
        <h2 class="titulo-ocu text-center">Ocupaci√≥n Actual</h2>
        <div class="contador text-center">{{ personasDentro }}</div>
        <p class="sub text-center">personas dentro del gimnasio</p>
      </div>

      <!-- Movimientos -->
      <div class="movimientos-card bg-white shadow rounded-4 p-4 mb-4">
        <h3 class="fw-bold text-center">Movimientos Recientes</h3>

        <div class="movimientos-row">
          <div class="movimiento-foto" *ngFor="let m of ocupacion">
            <img [src]="m.foto || 'assets/img/perfil/user-sin-foto.png'" class="avatar" />
          </div>
        </div>
      </div>
      <!-- RESUMEN DE CUOTA -->
      <div class="cuota-card bg-white shadow rounded-4 p-4 mb-4">

        <h3 class="fw-bold text-center mb-3">
          Estado de tu Cuota
        </h3>

        <div class="d-flex justify-content-center mb-3">
          <span class="material-symbols-outlined me-2"
                style="font-size: 32px; color: var(--color-secundario);">
            account_balance_wallet
          </span>
          <div>
            <p class="m-0 text-dark fw-semibold">
              Vence el:
              <strong>{{ socio?.cuotaPagadaHasta | date:'dd/MM/yyyy' }}</strong>
            </p>

            <small class="text-muted">
              Te quedan
              <strong>{{ diasRestantesCuota }}</strong>
              d√≠as de acceso
            </small>
          </div>
        </div>

      


        <!-- BOT√ìN RENOVAR -->
        <div class="text-center mt-3">
          <button class="btn btn-fitrank w-100"
                  (click)="navegarA('/pagos')">
            <span class="material-symbols-outlined me-2">autorenew</span>
            Renovar cuota Con Descuento
          </button>
        </div>

      </div>

    </div>



    <!-- ========================= -->
    <!-- üü£ COLUMNA CENTRAL -->
    <!-- ========================= -->
    <div class="col-lg-5 col-md-12">

      <!-- PERFIL COMPLETO -->
      <div class="panel-perfil bg-white shadow rounded-4 p-4 mb-4 text-black">

        <!-- CABECERA -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="fw-bold text-fitrank m-0">Mi Perfil</h3>

          <div class="d-flex gap-2">
            <button class="btn btn-fitrank" (click)="toggleEditarPerfil()"><i class="bi bi-pencil"></i> Editar Perfil</button>
            <button class="btn btn-secondary" (click)="toggleMedidas()">üìè Medidas</button>
            <button class="btn btn-secondary" (click)="toggleMedidas()">üìè Medidas</button>
            <button class="btn btn-secondary" (click)="toggleMedidas()">üìè Medidas</button>
          </div>
        </div>

        <!-- FOTO + DATOS -->
        <div class="row g-3">
          <div class="col-md-4 text-center">
            <img [src]="socio?.fotoUrl || 'assets/img/perfil/user-sin-foto.png'"
                 class="rounded-circle border"
                 width="120" height="120" />
          </div>

          <div class="col-md-8">
            <p><strong>Nombre:</strong> {{ socio?.nombre }} {{ socio?.apellido }}</p>
            <p><strong>Sexo:</strong> {{ socio?.sexo }}</p>
            <p><strong>Altura:</strong> {{ socio?.altura }} cm</p>
            <p><strong>Peso:</strong> {{ socio?.peso }} kg</p>
            <p><strong>Inicio:</strong> {{ socio?.fechaRegistro | date:'dd/MM/yyyy' }}</p>
 
          </div>
        </div>

        <!-- EDITAR PERFIL -->
        <div *ngIf="mostrarEditarPerfil" class="editar-perfil-card mt-4 p-4">
          <h4 class="fw-bold mb-4 titulo-seccion"> <i class="bi bi-pencil-square me-2"></i> Editar Perfil </h4> <div class="row g-4"> <!-- FOTO --> <div class="col-md-6"> <label>Foto de Perfil</label> <input type="file" class="form-control" accept="image/*" (change)="onSeleccionarFoto($event)"> </div> <!-- CAMPOS --> <div class="col-md-8"> <div class="row g-3"> <div class="col-md-6"> <label class="form-label"> <i class="bi bi-person me-1"></i> Nombre </label> <input class="form-control" [(ngModel)]="formEditar.nombre"> </div> <div class="col-md-6"> <label class="form-label"> <i class="bi bi-person me-1"></i> Apellido </label> <input class="form-control" [(ngModel)]="formEditar.apellido"> </div> <div class="col-md-6"> <label class="form-label"> <i class="bi bi-gender-ambiguous me-1"></i> Sexo </label> <select class="form-control" [(ngModel)]="formEditar.sexo"> <option value="">Seleccionar</option> <option value="F">Femenino</option> <option value="M">Masculino</option> <option value="X">Otro</option> </select> </div> <div class="col-md-6"> <label class="form-label"> <i class="bi bi-rulers me-1"></i> Altura (cm) </label> <input type="number" class="form-control" [(ngModel)]="formEditar.altura"> </div> <div class="col-md-6"> <label class="form-label"> <i class="bi bi-activity me-1"></i> Peso (kg) </label> <input type="number" class="form-control" [(ngModel)]="formEditar.peso"> </div> </div> </div> </div> <!-- BOT√ìN GUARDAR --> <div class="text-end mt-4"> <button class="btn-guardar" (click)="guardarPerfil()"> <i class="bi bi-save me-2"></i> Guardar </button> </div>

        </div>

        <!-- MEDIDAS -->
        <div *ngIf="mostrarMedidas" class="mt-4 p-3 border rounded-3 text-black">
          <h4 class="fw-bold mb-3">Medidas Corporales</h4> <!-- Formulario nueva medida --> <!-- Formulario nueva medida --> <div class="row g-3"> <div class="col-md-4"> <label>Pecho (cm)</label> <input class="form-control" placeholder="Ej: 95" [(ngModel)]="formMedida.pechoCm"> <small class="text-muted"> ‚û§ Med√≠ la circunferencia pasando la cinta por la parte m√°s alta del pecho. </small> </div> <div class="col-md-4"> <label>Cintura (cm)</label> <input class="form-control" placeholder="Ej: 72" [(ngModel)]="formMedida.cinturaCm"> <small class="text-muted"> ‚û§ Med√≠ alrededor del ombligo sin apretar la cinta. </small> </div> <div class="col-md-4"> <label>Cadera (cm)</label> <input class="form-control" placeholder="Ej: 98" [(ngModel)]="formMedida.caderaCm"> <small class="text-muted"> ‚û§ Med√≠ la zona m√°s ancha de la cadera y gl√∫teos. </small> </div> <div class="col-md-4"> <label>Brazo Derecho (cm)</label> <input class="form-control" placeholder="Ej: 28" [(ngModel)]="formMedida.brazoDerechoCm"> <small class="text-muted"> ‚û§ Rode√° el brazo por el punto medio entre hombro y codo. </small> </div> <div class="col-md-4"> <label>Brazo Izquierdo (cm)</label> <input class="form-control" placeholder="Ej: 27.5" [(ngModel)]="formMedida.brazoIzquierdoCm"> <small class="text-muted"> ‚û§ Misma t√©cnica que brazo derecho, siempre relajado. </small> </div> <div class="col-md-4"> <label>Peso (kg)</label> <input class="form-control" placeholder="Ej: 63.2" [(ngModel)]="formMedida.pesoKg"> <small class="text-muted"> ‚û§ Preferiblemente en ayunas o mismo horario cada d√≠a. </small> </div> </div> <div class="text-end mt-3"> <button class="btn btn-success" (click)="guardarMedida()">‚ûï Agregar Medida</button> </div> <!-- Historial --> <h5 class="mt-4">Historial</h5> <table class="table table-striped mt-2"> <thead> <tr> <th>Fecha</th> <th>Pecho</th> <th>Cintura</th> <th>Cadera</th> <th>Peso</th> </tr> </thead> <tbody> <tr *ngFor="let m of historialMedidas"> <td>{{ m.fecha | date:'dd/MM/yyyy' }}</td> <td>{{ m.pechoCm }}</td> <td>{{ m.cinturaCm }}</td> <td>{{ m.caderaCm }}</td> <td>{{ m.pesoKg }}</td> </tr> </tbody> </table>

        </div>

      </div>


      <!-- ENTRENAMIENTO DEL D√çA -->
      <div class="card overflow-hidden shadow-sm border-0 rounded-4 mb-4">
        <div class="row g-0">
          <div class="col-md-6" style="
              background-image:url('https://images.unsplash.com/photo-1571902943202-507ec2618e8f?auto=format&fit=crop&w=800&q=80');
              background-size:cover;background-position:center;min-height:230px;">
          </div>

          <div class="col-md-6 p-4 d-flex flex-column justify-content-center">
            <h4 class="fw-bold mb-2 text-fitrank">Entrenamiento del d√≠a</h4>
            <p class="text-muted mb-3">Rutina actual: <strong>Full Body Power</strong></p>

            <button class="btn btn-fitrank d-flex align-items-center gap-2 w-100"
                    (click)="navegarA('/rutina/mis-rutinas')">
              <span class="material-symbols-outlined">play_arrow</span>
              Iniciar entrenamiento
            </button>
          </div>
        </div>
      </div>

      <!-- ACCIONES R√ÅPIDAS -->
      <section class="mb-4">
        <div class="row g-3 justify-content-center"> <div class="col-12 col-md-3"> <button class="quick-action w-100 btn-secondary" (click)="navegarA('/ranking')"> <span class="material-symbols-outlined me-2">emoji_events</span> Ranking </button> </div> <div class="col-12 col-md-3"> <button class="quick-action w-100 btn-secondary" (click)="navegarA('/rutina/crear/')"> <span class="material-symbols-outlined me-2">add_circle</span> Crear rutina </button> </div> <div class="col-12 col-md-3"> <button class="quick-action w-100 btn-secondary" (click)="navegarA('/rutina/mis-rutinas')"> <span class="material-symbols-outlined me-2">list_alt</span> Mis rutinas </button> </div> <div class="col-12 col-md-3"> <button class="quick-action w-100 btn-secondary" (click)="navegarA('/socios/1/gimnasios/1/logros')"> <span class="material-symbols-outlined me-2">military_tech</span> Mis logros </button> </div> </div>
      </section>

      <!-- TARJETA RETENCI√ìN -->
      <div *ngIf="mostrarRetencion" class="card-retencion text-center mb-4">
        <h5 class="text-fitrank fw-bold mb-3">üí™ ¬°Te extra√±amos en FitRank!</h5> <p>Hace algunos d√≠as que no registramos tus entrenamientos. ¬øQuer√©s retomar con energ√≠a?</p> <div class="d-flex flex-column gap-2 mt-3"> <button class="btn btn-primary w-100 btn-secondary" (click)="responder('cambiar-rutina')"> üîÑ Cambiar rutina </button> <button class="btn btn-success w-100 btn-secondary" (click)="responder('estoy-bien')"> ‚úÖ Estoy bien </button> <button class="btn btn-warning w-100 btn-secondary" (click)="responder('contactar-profesor')"> Que me contacte un profesor </button> </div>
      </div> <!-- üîπ Tarjeta de retenci√≥n (solo visible si hay notificaci√≥n) --> <div *ngIf="mostrarRetencion" class="card-retencion text-center"> <h5 class="text-fitrank fw-bold mb-3">¬°Te extra√±amos en FitRank!</h5> <p> Hace algunos d√≠as que no registramos tus entrenamientos.<br /> ¬øQuer√©s retomar con energ√≠a? </p> </div>
    

 

    </div>





    <!-- ========================= -->
    <!-- üîµ COLUMNA DERECHA (SIDEBAR NOTIFICACIONES) -->
    <!-- ========================= -->
    <div class="col-lg-3 col-md-12">
      <h4 class="fw-bold text-center mb-3"> Notificaciones</h4>
      <!-- NOTIFICACIONES GLOBALES -->
      <div class="sidebar-noti bg-white shadow rounded-4 p-3 mb-4">
        <h4 class="fw-bold text-center mb-3">Globales</h4>

        <div class="list-group small">
          <div class="list-group-item border-0 border-bottom bg-light d-flex">
            <span class="material-symbols-outlined me-2 mt-1">campaign</span>
            <div>
              <p class="fw-semibold mb-1">Nueva clase disponible</p>
              <small class="text-muted">Yoga funcional se a√±adi√≥ esta semana.</small>
            </div>
          </div>

          <div class="list-group-item border-0 border-bottom bg-light d-flex">
            <span class="material-symbols-outlined me-2 mt-1">event</span>
            <div>
              <p class="fw-semibold mb-1">Competencia mensual</p>
              <small class="text-muted">Inscribite al desaf√≠o Strong Week.</small>
            </div>
          </div>

          <div class="list-group-item border-0 bg-light d-flex">
            <span class="material-symbols-outlined me-2 mt-1">local_fire_department</span>
            <div>
              <p class="fw-semibold mb-1">Nuevos r√©cords!</p>
              <small class="text-muted">M√°s de 10.000 entrenamientos este mes.</small>
            </div>
          </div>
        </div>

        <div class="text-center mt-3">
          <button class="btn btn-secondary w-100" (click)="navegarA('/notificaciones-globales')">
            Ver todas
          </button>
        </div>
      </div>

      <!-- NOTIFICACIONES PERSONALES -->
      <div class="sidebar-noti bg-white shadow rounded-4 p-3">
        <h4 class="fw-bold text-center mb-3">Personales</h4>

        <div class="list-group small">
          <div class="list-group-item border-0 border-bottom bg-light d-flex">
            <span class="material-symbols-outlined me-2 mt-1">celebration</span>
            <div>
              <p class="fw-semibold mb-1">¬°Nuevo logro!</p>
              <small class="text-muted">‚ÄúGuerrero del Fin de Semana‚Äù.</small>
            </div>
          </div>

          <div class="list-group-item border-0 border-bottom bg-light d-flex">
            <span class="material-symbols-outlined me-2 mt-1">calendar_month</span>
            <div>
              <p class="fw-semibold mb-1">Clase hoy</p>
              <small class="text-muted">Spinning a las 18:00.</small>
            </div>
          </div>

          <div class="list-group-item border-0 bg-light d-flex">
            <span class="material-symbols-outlined me-2 mt-1">task_alt</span>
            <div>
              <p class="fw-semibold mb-1">Rutina actualizada</p>
              <small class="text-muted">Se actualiz√≥ tu rutina de piernas.</small>
            </div>
          </div>
        </div>

        <div class="text-center mt-3">
          <button class="btn btn-secondary w-100" (click)="navegarA('/notificaciones-personales')">
            Ver todas
          </button>
        </div>

        <!-- Logout -->
        <div class="text-center mt-4">
          <button class="btn btn-outline-fitrank w-100 btn-secondary" (click)="logout()">
            <span class="material-symbols-outlined me-2">logout</span>
            Cerrar sesi√≥n
          </button>
        </div>
      </div>

    </div>

  </div>
</div>

<!-- üßë‚Äçüè´ PANEL DEL PROFESOR -->
<div *ngIf="esProfesor" class="container py-5 text-center">
  <app-header-profesor [user]="user"></app-header-profesor><br />

  <h2 class="display-6 fw-bold text-dark">¬°Profe, {{ user.nombre }}!</h2>



  <p class="text-muted mb-5">Gestion√° tus rutinas, alumnos y notificaciones üëá</p>

  <div class="row g-4 justify-content-center">
    <div class="col-12 col-md-4">
      <button class="quick-action w-100 btn-secondary" (click)="navegarA('/rutina/mis-rutinas')">
        <span class="material-symbols-outlined me-2">list_alt</span>
        Ver mis rutinas creadas
      </button>
    </div>

    <div class="col-12 col-md-4">


      <button class="quick-action w-100  btn-secondary" (click)="navegarA('/profesor/progreso-alumnos')">
        <span class="material-symbols-outlined me-2">group</span>
        Ver progreso alumnos
      </button>
    </div>

    <div class="row g-4 justify-content-center">
      <div class="col-12 col-md-4">
        <button class="quick-action  btn-secondary" (click)="navegarA('solicitudes-profesor')">
          <span class="material-symbols-outlined me-2">list_alt</span>
          Panel de Solictudes Generales
        </button>
      </div>

      <div class="col-12 col-md-4">
        <button class="quick-action  btn-secondary" (click)="navegarA('/profesor/alumnos')">
          <span class="material-symbols-outlined me-2">group</span>
          Ver mis alumnos
        </button>
      </div>

      <!-- No puedo acceder al gimnasioId de los profesores en en login
      <div class="col-12 col-md-4">
        <button class="quick-action w-100  btn-secondary" (click)="navegarA('/reportes/mis-reportes')">
          <span class="material-symbols-outlined me-2">assignment</span>
          Mis reportes
        </button>
      </div>
      -->

      <div class="col-12 col-md-4">
        <button class="quick-action w-100" (click)="navegarA('/notificaciones-profesor')">

          <span class="material-symbols-outlined me-2">notifications_active</span>
          Notificaciones
        </button>
      </div>
    </div>
  </div>
</div>
