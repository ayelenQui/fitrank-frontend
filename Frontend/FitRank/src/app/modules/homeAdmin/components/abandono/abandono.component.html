<div class="container py-4">
  <h2 class="text-center fw-bold text-fitrank mb-4"> Panel de Asistencias y RetenciÃ³n</h2>

  <!-- ðŸ” FILTRO POR NOMBRE -->
  <div class="card bg-dark text-light p-3 shadow-sm mb-4 rounded-4">
    <label class="form-label text-fitrank fw-semibold">Filtrar por nombre de socio:</label>
    <input type="text"
           [(ngModel)]="filtroSocio"
           (input)="filtrarPorSocio()"
           class="form-control bg-secondary text-light border-0"
           placeholder="Buscar Socio" />
  </div>

  <!-- â³ CARGANDO -->
  <div *ngIf="loading" class="text-center py-4">
    <div class="spinner-border text-fitrank" role="status"></div>
    <p class="mt-2 text-light">Cargando datos...</p>
  </div>

  <!-- âš ï¸ MENSAJE GENERAL -->
  <div *ngIf="!loading && mensaje" class="alert alert-info text-center mx-auto w-75">
    {{ mensaje }}
  </div>

  <!-- âœ… LISTADO DE ASISTENCIAS -->
  <div *ngIf="!loading && asistenciasFiltradas.length > 0" class="mb-5">
    <h4 class="text-fitrank fw-bold mb-3"> Asistencias registradas</h4>

    <div class="table-responsive rounded-4 shadow-sm">
      <table class="table table-dark table-striped align-middle mb-0">
        <thead class="text-fitrank">
          <tr>
            <th>Socio</th>
            <th>Gimnasio</th>
            <th>Fecha</th>
            <th>Entrada</th>
            <th>Salida</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let asistencia of asistenciasFiltradas">
            <td>{{ asistencia.nombreSocio }}</td>
            <td>{{ asistencia.gimnasioNombre }}</td>
            <td>{{ asistencia.fecha | date: 'dd/MM/yyyy' }}</td>
            <td>{{ asistencia.horaEntrada | date: 'HH:mm' }}</td>
            <td>{{ asistencia.horaSalida ? (asistencia.horaSalida | date: 'HH:mm') : '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ðŸš« SIN ASISTENCIAS -->
  <div *ngIf="!loading && asistenciasFiltradas.length === 0" class="text-center text-light mt-4">
    <p class="text-muted">No hay asistencias registradas aÃºn.</p>
  </div>

  <hr class="my-5 text-fitrank opacity-75" />

  <!-- ðŸ‘¥ SOCIOS INACTIVOS -->
  <div *ngIf="!loading && inactivos.length > 0">
    <h4 class="text-black fw-bold mb-3"> Socios en Riesgo de Abandono (mÃ¡s de 5 dÃ­as sin asistir)</h4>

    <div class="row g-3">
      <div *ngFor="let socio of inactivos" class="col-md-6 col-lg-4">
        <div class="card bg-dark text-light shadow-sm rounded-4 p-3 border border-fitrank h-100">
          <h5 class="fw-bold text-fitrank mb-1">{{ socio.nombre }} {{ socio.apellido }}</h5>
          <p class="mb-1"><strong>Email:</strong> {{ socio.email }}</p>
          <p class="mb-1"><strong>TelÃ©fono:</strong> {{ socio.telefono || 'No registrado' }}</p>
          <p class="mb-1"><strong>DÃ­as sin asistir:</strong> {{ socio.diasSinAsistir }}</p>

        

          <div class="mt-3 d-flex gap-2">
            <button class="btn btn-outline-fitrank flex-grow-1" (click)="retenerSocio(socio.id)">
              ðŸ“¨ Retener socio
            </button>

            <button *ngIf="socio.telefono"
                    class="btn btn-success flex-grow-1"
                    (click)="abrirWhatsApp(socio.telefono, socio.nombre)">
              ðŸ’¬ WhatsApp
            </button>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… SIN SOCIOS INACTIVOS -->
  <div *ngIf="!loading && inactivos.length === 0" class="text-center text-light mt-4">
    <p class="text-muted">Todos los socios estÃ¡n activos ðŸ’ª</p>
  </div>
</div>
